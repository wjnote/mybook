# Ta404 使用记录

1. 最常用的功能是 表格加分页组件的一起使用
    ```js
    <ta-table
      class="g-tablecontent"
      bordered
      haveSn
      :columns="columns"
      :dataSource="dataSourceTable"
      :scroll="{ y: '100%' }"
      :customRow="tableAdapt"
    > 
        <!-- 如果表格有操作动作的话就需要添加这部分  -->
        <template
          slot="operator"
          slot-scope="text, record"
        >
          <a @click="handleShow(record.employeeId)">查看</a>    <!-- employeeId 表示你需要点击的时候传入到函数的参数，可以是该行的id值 -->
        </template>
    </ta-table>
    <ta-pagination
      class="g-pagination"
      showSizeChanger
      showQuickJumper
      :dataSource.sync="dataSourceTable"
      :params="userPageParams"
      :url="pageUrl"
      ref="gridPager"
    />
    
    // 最基本的表头数据 
    const columns = [
      {
        dataIndex: "employeeName",
        title: "姓名",
        // width: 100
        width: '10%'
      },{
        dataIndex: "age",
        title: "姓名",
        width: '10%'
      },
      {
        title: "操作",
        align: "center",
        scopedSlots: { customRender: "operator" },
        width: '10%'
      }
    ];
    data(){
        return {
            pageUrl:'',
            dataSourceTable:[],
        }
    },
    mounted(){
        this.qeury(); // 加载的时候执行 请求后台数据
    },
    methods:{
        tableAdapt,
        userPageParams(){
            return {}
        },
        qeury(){
            // 执行请求数据的时候会先执行 userPageParams() 这个方法，把数据添加到请求 form.data 中
            this.$refs.gridPager.loadData();  
        }
    }
    ```
    1. 其中 `columns` 表示表格的表头内容， `dataSourceTable` 表示表格主体的内容部分，两者使用 `dataIndex` 来关联数据
    2. pageUrl 是请求后台的URL地址，请求数据的
    3. userPageParams 是 methods 中的一个方法，在该方法中会返回一个对象，该对象就是向后台传递的参数 ，其中有 `pageNumber: 1  pageSize: 10` 这两个参数是默认的，不用设置，获取用户设置的输入内容也在该方法内
    4.  设置了`:scroll="{ y: '100%' }"` 的话，一般会导致表格主体部分出现滚动条边框对不齐，这个时候在`columns`数据中设置 `width` 最后一个不要设置数值，就可以对齐表格
    5.  公司在项目中优化了表格，在表格中加上 ` :customRow="tableAdapt"` 并在 `methods`注册  `tableAdapt` 方法，然后再 columns 里面都使用百分比，就不会出现分辨率不一样，最后一行宽度变形的情况

2. 如果需要添加输入框或者选择的条件查询
    ```js
      <ta-form
        class="g-search-form"
        layout="inline"
        :autoFormCreate="form => (this.form = form)"
      >
        <ta-row>
            <ta-col :span="5">
              <ta-form-item
                label='姓名'
                fieldDecoratorId="employeeName"
                :labelCol="{ span: 6, offset: 2 }"
                :wrapperCol="{ span: 16 }"
                style="width: 30%"
              >
                <ta-input />
              </ta-form-item>
            </ta-col>
            <ta-col :span="5" :offset="1">
              <ta-button
                type='primary'
                @click="qeury"
                style="margin-right:20px"
              >提交</ta-button>
            </ta-col>
        </ta-row>
     </ta-form>

     methods:{
        getVlaue(){
            // 获取表单的全部的值
            let value = this.form.getFieldsValue();
            // 获取某一个具体的输入框值  通过 表单框的 `fieldDecoratorId`
            let value = this.form.getFieldValue('employeeName');
        },
        setValue(){
            // 通过 表单框的 `fieldDecoratorId`
            this.form.setFieldsValue({
                a: 1,
                b: 2
            })
        },
        verification(){
            this.form.validateFields((err, values) => {
                if (!err) {
                // 验证成功
                }
            }
        },
        reSetValue(){
            this.form.resetFields(); 
        }
     }
    ```
    1. 一般有输入框都可以使用 `ta-form` 表单框的方式，这样获取值或者设置值比较容易，同样也适用于表单时间选择
    2. 点击提交的时候，我们可以直接获取表单的全部数值，时间的话可以在表单的 `userPageParams` 方法中设置
    3. 如果是表单和table，分页条一起使用的话，submit 事件中只用触发发起数据请求，输入的内容都在`userPageParams`方法中获取输入的内容，具体看上面`<ta-form>` 的内容
    4. 自适应的话，最好在表单的输入框中使用栅格系统，利用24个栅格来自适应表单的输入框等
    5. 如果想用表单自带的验证功能，
          1. 需要在 `ta-form-item` 组件上使用 `:require="{message:'自定义年龄不能为空'}"` 属性，
          2. 在`this.Base.submit` 的第一个参数就是该表单的名字 `autoFormCreate` 的值
          3. 在接口参数 第三个参数 `autoValid: true // 提交前是否自动验证`

3. 时间选择器是个经常使用的，其中内部使用的 [Moment.js](https://momentjs.com/)
    ```js
      <ta-date-picker @change="onChange" />
        // 如果时间选择器是在表单中的话，需要下面这种方式
      <ta-form-item
          label='日期'
          fieldDecoratorId="startTime"
          :labelCol="{ span: 6, offset: 2 }"
          :wrapperCol="{ span: 16 }"
      >
          <ta-date-picker
            placeholder="请选择时间"
            size="large"
            :format="'YYYY-MM-DD'"
          />
      </ta-form-item>

      // 如果是在表单中获取该时间选择框的值 返回的是一个 moment 对象
      this.form.getFieldValue("startTime").format("YYYY-MM-DD");   // 2019-08-08 返回的格式
    ```

4. 码值转换，有些判断的值后台返回给我的是数字类型，
    ```js
        {{CollectionLabel('SEX', text)}}
        // 下拉框数据使用码值：
        <ta-tag-select :data="CollectionData('YESORNO')"></ta-tag-select>
    ```
	

5. 上传功能，可以使用Ta404的上传插件组件
    ```js
      <ta-upload
        name="file"
        style="margin-right:20px;"
        :action="uploadUrl"
        :beforeUpload="beforeUpload"
        :showUploadList="false"
        @change="uploadChange"
      >
        <ta-button
          type="primary"
          class="click-btn white-btn"
          icon="cloud-upload-o"
        >员工家庭信息导入</ta-button>
      </ta-upload>
  
      data(){
        return {
          uploadUrl: "" //faceConfig.basePath + api.uploadUrl  上传的时候的后台接口地址
        }
      },
      methods:{
        // 导入功能 验证文件格式 只能是 excel
        beforeUpload(file) {
          if (file.type.indexOf("officedocument") === -1) {
            this.$message.error("只能导入excel格式的文件");
            return false;
          }
        },
        uploadChange(info) {
          if (info.file.status === "done") {
            let result = info.file.response.data.reMap;
            if (result.isError) {
              this.$confirm({
                title: "导入异常",
                content: "是否下载异常数据？",
                okText: "是",
                cancelText: "否",
                onOk: () => {
                  let form = document.getElementById("download");
                  if (!form) {
                    form = document.createElement("form");
                  }
                  form.id = "download";
                  form.method = "post";
                  form.action =
                    faceConfig.basePath +
                    api.downOtherUrl +
                    "?filePath=" +
                    result.filePath +
                    "&fileName=haha";
                  document.body.appendChild(form);
                  form.submit();
                },
                onCancel: () => {}
              });
            } else {
              this.$message.success("导入成功");
            }
          }
        },
      }
    ```

6. 员工信息部分的员工所属班组，所属车间，所属企业的选择功能，杨婷写了一个插件，可以直接使用

7. RAP2一般使用的是 `post` 请求，在使用的时候，直接点击地址预览的话，需要在 URL 中，地址那部分前面加 `/POST` 的方式才能访问，在公司框架中使用 Base.submit() 请求的时候，也是需要加上 `POST` 才能访问

8. 数据中如果涉及到表单的内容的话，返回的格式必须是统一的，可以参考 `staffInfo` 这个接口， TA404 必须要固定的参数才能设置到表单中

9. 开发中使用的如果是mock 的方式，涉及到表格和分页条的话，那`mock`的数据格式只能是下面的格式   其中的`data.pageBean`也是必须的，只能是`list`内部的修改，这样才能自动填入到表格中
  ```js
  {
    "code": 200,
    "requestId": "c7587648-2a6a-4af4-a1b8-b3948fb3e3f6",
    "data": {
      "pageBean": {
        "pageNum": 1,
        "pageSize": 10,
        "currentSize": 2,
        "total": 2,
        "pages": 1,
        "list": [{
          "workshopname": "二车间",
          "workshophead": "负责人2",
          "workshopid": "2",
          "enterpriseid": "1",
          "workshopemployeenumber": 0,
          "workshopheadtel": "18783981376"
        }]
      }
    },
    "errors": null,
    "serviceSuccess": true,
    "redirectUrl": null
  }
  ```

10. 如果是普通的接口，则需要配置成下面的格式，`data`就是配置参数
  ```js
  code: 200
  data: {}
  errors: null
  redirectUrl: null
  requestId: "7ea714e6-5e91-48d4-b753-736423ce2445"
  ```


10. 项目`webpack` 的代理设置
    ```js
       // 基础路径,打包发布的时候修改为后端发布服务地址
      'basePath': 'http://192.168.22.26:8081/git',
      // 开发模式mockServer服务地址
      'mockServer': 'http://192.168.17.50:38080/app/mock/53',
        // 开发模式后端服务地址
      'devServer': 'http://192.168.22.26:8081/git',

        // dev-mock 的使用弹出
        {
          'http://192.168.22.26:8081/git': {
            target: 'http://localhost:36742/',
            changeOrigin: true,
            pathRewrite: {
              '^http://192.168.22.26:8081/git': '/'
            }
          }
        }

      // npm run dev
      {}

      // npm run dev-server
      {
        'http://192.168.22.26:8081/git': {
          target: 'http://192.168.22.26:8081/git',
          changeOrigin: true,
          pathRewrite: {
            '^http://192.168.22.26:8081/git': '/'
          }
        }
      }
    ```
